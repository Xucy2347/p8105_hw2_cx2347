---
title: "p8105_hw2_cx2347"
author: "Chuyuan XU"
date: "2025-09-23"
output: html_document
---

```{r setup, message=FALSE}
library(tidyverse)
library(tidyr)
library(readxl)
```

## Problem 1

```{r pols-month, message=FALSE}
# clean the data in pols-month.csv
pols = read_csv(
  "data/FiveThirtyEight_data/pols-month.csv",
  na = c("NA", ".", "")
  ) |>
  janitor::clean_names() |>
  
  # break up the variable 'mon' into 'year', 'month' and 'day'
  separate(
    mon,
    into = c('year', 'month', 'day'),
    sep = '-'
  ) |>
  
  # change the format of 'year' and 'month'
  mutate(year = as.numeric(year)) |>
  mutate(month = as.numeric(month)) |>
  mutate(month = month(month, label = TRUE, abbr=FALSE)) |>
  
##########???????########  there is a 2?
  # create the variable 'president' and drop 'prez_gop and 'prez_dem' 
  pivot_longer(
    cols = c(prez_gop, prez_dem),
    names_to = 'president',
    values_to = 'ind'
  ) |>
  filter(ind != 0) |>
  mutate(president = case_match(
    president,
    'prez_gop' ~ 'gop',
    'prez_dem' ~ 'dem'
  )) |>
  select(-ind) |>
  
  # drop the 'day' variable
  select(-day)
```

```{r snp, message=FALSE}
# clean the data in snp.csv
snp = 
  read_csv(
    "data/FiveThirtyEight_data/snp.csv",
    na = c("NA", ".", "")
  ) |>
  janitor::clean_names() |>
  
  # break up the get 'year', 'month' from variable 'date'
  mutate(
    date = 
      parse_date_time2(
        date, 
        orders="m/d/y", 
        cutoff_2000 = 20L
      )
    ) |> 
  mutate(year = year(date)) |>
  mutate(month = month(date, label = TRUE, abbr = FALSE)) |>
  
  # rearrange the data and drop the 'date' variable
  select(year, month, everything(), -date)
```

```{r unemployment, message=FALSE}
# clean the data in unemployment.csv
ue = 
  read_csv(
    "data/FiveThirtyEight_data/unemployment.csv",
    na = c("NA", ".", "")
  ) |>
  janitor::clean_names() |>
  
  # switch from wide to long format
  pivot_longer(
    cols = jan:dec,
    names_to = 'month',
    values_to = 'unemployment',
  ) |>

  # change the format of the month
  mutate(month = parse_date_time(
    month,
    orders = 'b')) |>
  mutate(month = month(month, label =TRUE, abbr = FALSE))
```

```{r merging, message=FALSE}
# Join the datasets by merging snp into pols
result = left_join(pols, snp, by = c('year', 'month'))

# merging unemployment into the result.
result = left_join(result, ue, by = c('year', 'month'))
```

# Reporting the Datasets:

The dataset 'pols' contains variables related to the number of politicians who are democratic or republican in national institutes.
The year range of the dataset is between `r min(pull(pols, year))` and `r max(pull(pols, year))`.
There are `r nrow(pols)` rows and `r ncol(pols)` columns in the data frame.
There are `r ncol(pols)` variables:
  'year', 'month' (the year and month when the number was counted),
  'gov_gop' (the number of republican governors on the associated date),
  'sen_gop' (the number of republican senators on the associated date),
  'rep_gop' (the number of republican representatives on the associated date),
  'gov_dem' (the number of democratic governors on the associated date),
  'sen_dem' (the number of democratic senators on the associated date),
  'rep_dem' (the number of democratic representatives on the associated date),
  'president' (on the associated year and month, whether the president is republican or democratic).
\
\
The dataset 'snp' records the closing values of the S&P stock index in the associated year and month with the variable 'close'.
The year range of the dataset is between `r min(pull(snp, year))` and `r max(pull(snp, year))`.
There are `r nrow(snp)` rows and `r ncol(snp)` columns in the data frame.
There are `r ncol(snp)` variables. Besides the variable 'close', variables 'year' and 'month' are the year and month when the number was counted.
\
\
The dataset 'ue' records the percentage of the unemployment rate in the associated year and month with the variable 'unemployment'.
The year range of the dataset is between `r min(pull(ue, year))` and `r max(pull(ue, year))`.
There are `r nrow(ue)` rows and `r ncol(ue)` columns in the data frame.
There are `r ncol(ue)` variables. Besides the variable 'unemployment', variables 'year' and 'month' are the year and month when the number was counted.
\
\
The final 'result' dataset is merged from the datasets mentioned above.
The year range of the dataset is between `r min(pull(result, year))` and `r max(pull(result, year))`.
There are `r nrow(result)` rows and `r ncol(result)` columns in the data frame.
There are `r ncol(result)` variables included:
  'year', 'month' (the year and month when the number was counted),
  'gov_gop' (the number of republican governors on the associated date),
  'sen_gop' (the number of republican senators on the associated date),
  'rep_gop' (the number of republican representatives on the associated date),
  'gov_dem' (the number of democratic governors on the associated date),
  'sen_dem' (the number of democratic senators on the associated date),
  'rep_dem' (the number of democratic representatives on the associated date),
  'president' (on the associated year and month, whether the president is republican or democratic),
  'close' (the closing values of the S&P stock index in the associated year and month),
  'unemployment' (the percentage of the unemployment rate in the associated year and month).

 